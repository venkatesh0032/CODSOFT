# todo.py

import json
import os
from colorama import Fore, Style, init

# Initialize colorama
init(autoreset=True)

TASKS_FILE = "tasks.json"
tasks = []  # List to store all tasks


# ----------------- Utility Functions -----------------
def save_tasks():
    """Save tasks to a JSON file"""
    with open(TASKS_FILE, "w") as f:
        json.dump(tasks, f, indent=4)


def load_tasks():
    """Load tasks from a JSON file"""
    global tasks
    if os.path.exists(TASKS_FILE):
        with open(TASKS_FILE, "r") as f:
            tasks = json.load(f)


# ----------------- Task Functions -----------------
def show_tasks():
    """Display all tasks"""
    if not tasks:
        print(Fore.YELLOW + "\nğŸ“Œ No tasks available!\n")
    else:
        print(Fore.CYAN + "\nğŸ“‹ Your To-Do List:")
        for i, task in enumerate(tasks, 1):
            status = Fore.GREEN + "âœ… Done" if task['done'] else Fore.RED + "âŒ Not Done"
            due = f" (ğŸ•’ Due: {task['due']})" if task['due'] else ""
            print(f"{i}. {task['title']} [{task['category']}] ---> {status}{due}")
    print()


def add_task():
    """Add a new task"""
    title = input("âœ Enter task: ").strip()
    if not title:
        print(Fore.RED + "âš  Task cannot be empty!\n")
        return

    category = input("ğŸ“‚ Enter category (Work/Study/Personal/General): ").capitalize()
    if category not in ["Work", "Study", "Personal", "General"]:
        category = "General"

    due = input("ğŸ•’ Enter due date (optional, e.g., 2025-09-01): ").strip()

    tasks.append({"title": title, "done": False, "category": category, "due": due})
    save_tasks()
    print(Fore.GREEN + "âœ” Task added successfully!\n")


def mark_done():
    """Mark a task as completed"""
    show_tasks()
    try:
        task_no = int(input("âœ… Enter task number to mark as done: "))
        tasks[task_no - 1]["done"] = True
        save_tasks()
        print(Fore.GREEN + "âœ” Task marked as done!\n")
    except (ValueError, IndexError):
        print(Fore.RED + "âš  Invalid task number!\n")


def delete_task():
    """Delete a task"""
    show_tasks()
    try:
        task_no = int(input("ğŸ—‘ Enter task number to delete: "))
        removed = tasks.pop(task_no - 1)
        save_tasks()
        print(Fore.GREEN + f"ğŸ—‘ Task '{removed['title']}' deleted!\n")
    except (ValueError, IndexError):
        print(Fore.RED + "âš  Invalid task number!\n")


def update_task():
    """Update an existing task"""
    show_tasks()
    try:
        task_no = int(input("âœ Enter task number to update: "))
        task = tasks[task_no - 1]

        new_title = input(f"ğŸ”¤ Enter new title (press Enter to keep '{task['title']}'): ").strip()
        if new_title:
            task["title"] = new_title

        new_category = input(f"ğŸ“‚ Enter new category (Work/Study/Personal/General) [current: {task['category']}]: ").capitalize()
        if new_category in ["Work", "Study", "Personal", "General"]:
            task["category"] = new_category

        new_due = input(f"ğŸ•’ Enter new due date (press Enter to keep '{task['due']}'): ").strip()
        if new_due:
            task["due"] = new_due

        save_tasks()
        print(Fore.GREEN + "âœ” Task updated successfully!\n")

    except (ValueError, IndexError):
        print(Fore.RED + "âš  Invalid task number!\n")


# ----------------- Main Menu -----------------
def main():
    """Main program loop"""
    load_tasks()
    while True:
        print(Fore.BLUE + Style.BRIGHT + "===== ğŸ“Œ TO-DO LIST MENU =====")
        print("1ï¸âƒ£  Show tasks")
        print("2ï¸âƒ£  Add task")
        print("3ï¸âƒ£  Mark task as done")
        print("4ï¸âƒ£  Delete task")
        print("5ï¸âƒ£  Update task")
        print("6ï¸âƒ£  Exit")

        choice = input("ğŸ‘‰ Choose an option (1-6): ").strip()

        if choice == "1":
            show_tasks()
        elif choice == "2":
            add_task()
        elif choice == "3":
            mark_done()
        elif choice == "4":
            delete_task()
        elif choice == "5":
            update_task()
        elif choice == "6":
            print(Fore.CYAN + "ğŸ‘‹ Exiting... Goodbye!")
            break
        else:
            print(Fore.RED + "âš  Invalid choice! Try again.\n")


if __name__ == "__main__":
    main()
